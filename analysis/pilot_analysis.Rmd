---
title: "pilot_analysis"
author: "Jess Mankewitz"
date: "2023-06-01"
output: html_document
---

This will outline the intended analysis of my FYP project "BabyInfo", which explores how toddlers may or may not actively sample informative speakers in their environment. 

# Setup

```{r}
library(here)
library(tidyverse)

source("Pygaze_processGazeData.R")
source("Pygaze_addAOIHits.R")
source("Pygaze_InterpolateAOIHits.R")

eyetracking_data_path <- here("BabyInfo_v1/eyetrackingData/")
trials_path <- here('BabyInfo_v1/data/')
```

# Adult Testing 

## Preprocess Data Files

The goal for this section is to have a set of functions/scripts that...
- Extract trial log information (Trial number, trial type, speaker type, etc) into columns
- normalize XY timepoints
- create AOI bins
- reasonably interpolate missing data

By the nature of my training, this will probably look a lot like peekbank scripts, because thats what I know
If you have other suggestions/suggested changes, do let me know! -JM

```{r}
adult_testing_folder <- 'adult_testing/'
adult_testing_data_path <- paste0(eyetracking_data_path, adult_testing_folder)

gazeDataNames = list.files(adult_testing_data_path, pattern=".tsv", full.names = T)

first_file = gazeDataNames[1]

gazeDataComplete = c()

integrateEventDataUpdated(first_file, skipNum = 7)
```


# Pilot 1

```{r}
polot_1_path <- 'pilot_1/'
pilot_1_data_path <- paste0(eyetracking_data_path, polot_1_path)

gazeDataNames = list.files(pilot_1_data_path, pattern=".tsv", full.names = T)

first_file = gazeDataNames[1]

gazeDataComplete = do.call(rbind, lapply(gazeDataNames, integrateEventDataUpdated))

gazeDataComplete_processed = processGazeData(gazeDataComplete)

gazeDataBinned = createTimeBins(gazeDataComplete_processed)

gazediffs <- gazeDataBinned |> select(TimeStamp, TimeBin, TimeBinMs) |> 
       mutate(diff = TimeStamp-TimeBinMs,
              expected_bin = seq(18, nrow(gazeDataBinned)+17),
              expected_ms = expected_bin*16.6666666666,
              diff2 = TimeStamp -expected_ms,
              bindiff = TimeBin - expected_bin)

# need to do some kind of cumsum situation to fill?

# first zero to the start of the trial
# then shift so its zeroed to the start of the screen


filled_data = gazeDataBinned |> 
  mutate(zeroed_time_ms = case_when(grepl("Experiment", gazeDataBinned$Event) ~ TimeStamp, 
                                   TRUE ~ NA)) |> 
  fill(zeroed_time_ms) |> 
  mutate(TimeStamp_zeroed = TimeStamp - zeroed_time_ms) |> 
  select(TimeStamp, TimeStamp_zeroed, everything())

```
